#!/bin/bash

RUN=/var/www/bin/client_queue.php
SPOOLDIR=/var/www/spool/pmq/clientspool/
STORAGE=filesystem
PHP=/usr/bin/php

[ -e ./dropr.cfg ] && . ./dropr.cfg
[ -e /etc/defaults/dropr ] && . /etc/defaults/dropr

clean_up()
{
    kill -SIGUSR1 $SLAVE
    exit
}

trap clean_up SIGHUP SIGINT SIGTERM

while [ 1 ]
do
    $PHP $RUN $STORAGE $SPOOLDIR &
    SLAVE=$!
    wait $SLAVE
done
