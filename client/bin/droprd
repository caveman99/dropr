#!/bin/bash

CONFIG="$1"

RUN=/var/www/bin/client_queue.php
SPOOLDIR=/var/www/spool/dropr/clientspool/
STORAGE=filesystem
PHP=/usr/bin/php

CWD=`dirname "$CONFIG"`
[ -e "$CONFIG" ] && . "$CONFIG"
[ -e /etc/default/dropr ] && . /etc/default/dropr

clean_up()
{
    kill -SIGUSR1 $SLAVE
    exit
}

trap clean_up SIGHUP SIGINT SIGTERM

while [ 1 ]
do
    $PHP $RUN $STORAGE $SPOOLDIR &
    SLAVE=$!
    wait $SLAVE
done
